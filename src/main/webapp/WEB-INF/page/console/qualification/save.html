<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8"/>
	<title>云之讯-短信平台</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="baidu-site-verification" content="zNwez22Bcq"/>
	<meta name="google-site-verification" content="6hC_46bMT6_bGxmL_Ec5V_7xnPSnQBhQBl8y3MtfoFc" />
	<meta name="Baiduspider" content="noarchive"/>
	<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/> 
	<link rel="shortcut icon" href="/img/logo2.png" type="image/x-icon" th:href="@{/img/logo2.png}">
	<link rel='stylesheet' href='/font/iconfont.css' th:href="@{/font/iconfont.css}"/>
	<link rel='stylesheet' href='/css/main.css' th:href="@{/css/main.css}"/>
	<script src="/js/jquery.min.js"  th:src="@{/js/jquery.min.js}"></script>
	<script src="/js/common.js" th:src="@{/js/common.js}"></script>
	<script type="text/javascript" src="/js/jquery.form.js" th:src="@{/js/jquery.form.js}"></script>
	<script type="text/javascript" src="/js/layer/layer.js" th:src="@{/js/layer/layer.js}"></script>

</head>
<body>
	<div id="wrap" class="clearfix">
		<!-- 左侧导航栏 bf-->
		<div id="sidebar">
			<div class="logo">
			    <a href="/" title="云之讯"><img src="/img/logo2.png" alt="云之讯" /></a>
			</div>
			<div class="nav">
			    <ul>
					<li><a href="/console" th:if="${accountModel.paytype ne 1}" ><span class="iconfont icon-shouyeshouye"></span>首页</a></li>
			        <li >
			            <a href="javascript:void(0)" ><span class="iconfont icon-duanxin"></span>传统短信<i></i></a>
			            <ul class="sub-nav">
			                <li><a href="/console/bussiness/send.html" class="" th:if="${session.LOGIN_USER_INFO.smsfrom==6}">短信发送<span></span></a></li>
			                <li><a href="/console/bussiness/template.html" class="" th:if="${session.LOGIN_USER_INFO.smsfrom==6}">短信模板管理<span></span></a></li>
			                <li><a href="/console/bussiness/record.html"  class="">短信发送记录<span></span></a></li>
			                <li><a href="/console/bussiness/statistics.html" class="">短信数据统计<span></span></a></li>
			                <li><a href="/console/bussiness/price.html"  class="">国际短信报价<span></span></a></li>
			            </ul>
			        </li>
			        <li th:if="${session.LOGIN_USER_INFO.smsfrom==6}">
			            <a href="javascript:void(0)"><span class="iconfont icon-caixin2"></span>彩印<i></i></a>
			            <ul class="sub-nav">
			                <li><a href="/console/mms/send.html" class="">彩印发送<span></span></a></li>
			                <li><a href="/console/mms/template.html" class="">彩印模版管理<span></span></a></li>
			                <li><a href="/console/mms/record.html"  class="">彩印发送记录<span></span></a></li>
			                <li><a href="/console/mms/ussdday.html" class="">彩印数据统计<span></span></a></li>
			            </ul>
			        </li>
			        <li>
			            <a href="javascript:void(0)"><span class="iconfont icon-qianbi01"></span>财务管理<i></i></a>
			            <ul class="sub-nav">
			                <li><a href="/console/order/list.html" class="">我的订单<span></span></a></li>
			            </ul>
			        </li>
			        <li class="cur">
			            <a href="javascript:void(0)" class="cur"><span class="iconfont icon-shenfenzheng"></span>账户管理<i class="show"></i></a>
			            <ul class="sub-nav">
			                <li><a href="/console/account/info.html" class="cur">账户资料<span></span></a></li>
			                <li><a href="/console/account/security.html" class="">账户安全<span></span></a></li>
			            </ul>
			        </li>
			        <li>
			            <a href="javascript:void(0)"><span class="iconfont icon-bangzhuzhongxin"></span>帮助中心<i></i></a>
			            <ul class="sub-nav">
			                <li><a href="/console/help/smsAccessIntroduce.html" class="">短信接入<span></span></a></li>
			                <li><a href="/console/help/FAQ.html" class="">FAQ<span></span></a></li>
			            </ul>
			        </li>
			    </ul>
			</div>
		</div>
		<!-- 左侧导航栏 ef -->

		<!-- 右边内容 bf -->
		<div id="main">
			<div class="main-con">
				<div class="top acount-top clearfix">
					<h1>账户管理</h1>
					<div class="ft-r ">
                        <a href="/console/login.html" class="lay-out btn-white btn-small btn" th:href="@{/console/quit}">退出</a>
                    </div>
                    
                    <!-- 
					<div class="top-r ft-r">
						<span class="contact-phone" th:text="'联系电话：'+${accountModel.agentMobile}">联系电话：18689206965</span>
					</div>
					-->
				</div>
				<div class="con-out">
		           <div class="crumbs">
						<a href="/console/account/info.html" th:href="@{/console/account/info}">基本资料</a>
						<a href="javascript:;" class="active">资质信息</a>
					</div>
					<div class="content acount-content"> 
						<div class="con-border a-info3 clearfix">
							<div class="tab clearfix">
								<label>认证类型：</label>
								<ul class="clearfix" >
									<li data-flag='dl-1' th:if="${cerInfo.clientType}==1"><a class="cur" href="javascript:void(0)">个人</a></li>
									<li data-flag='dl-2'  th:if="${cerInfo.clientType}==1"><a href="javascript:void(0)">公司</a></li>
							       <li data-flag='dl-1'  th:if="${cerInfo.clientType}==2"><a href="javascript:void(0)">个人</a></li>
								   <li data-flag='dl-2'  th:if="${cerInfo.clientType}==2"><a class="cur" href="javascript:void(0)">公司</a></li>
								</ul>
							</div>
							<div class="info">
							    <form method="post" class="clearfix" action="qualification/save" th:action="@{/console/qualification/save}" id="mainForm" novalidate="novalidate" enctype="multipart/form-data">
							    
								<input id="clientId" name="clientId" type="hidden" th:value="${accountModel.clientId }" />
							    <input name="agentId" type="hidden" th:value="${accountModel.agentId }"/>
							    <input id="clientType" name="clientType" th:type="hidden" type="hidden" th:value="${cerInfo.clientType }"/>
							    <input id="flag" name="flag" type="hidden" th:value="${flag}"/>
							    <input id="smsp_img_url" type="hidden" th:value="${smsp_img_url}"/>
								<dl id='dl-12'>
									<dt>用户账号：</dt>
									<dd th:text="${accountModel.clientId}">b00000</dd>
									<dt>证件类型：</dt>
									<dd class='dl-1' th:if="${cerInfo.clientType}==1">
										<select>
											<option value="1">身份证</option>
											<option value="2">护照</option>
										</select>
									</dd>
									<dd class='dl-2' style="display: none" th:if="${cerInfo.clientType}==1">
										<select>
											<option value="3">组织机构证</option>
											<option value="4">税务登记证</option>
											<option value="5">营业执照</option>
											<option value="6">三证合一(企业)</option>
											<option value="7">四证合一(企业)</option>
											<option value="8">登记证书号</option>
										</select>
									</dd>
									<dd class='dl-2' th:if="${cerInfo.clientType}==2">
										<select>
											<option value="3">组织机构证</option>
											<option value="4">税务登记证</option>
											<option value="5">营业执照</option>
											<option value="6">三证合一(企业)</option>
											<option value="7">四证合一(企业)</option>
											<option value="8">登记证书号</option>
										</select>
									</dd>
									<dd class='dl-1' style="display: none" th:if="${cerInfo.clientType}==2"> 
										<select>
											<option value="1">身份证</option>
											<option value="2">护照</option>
										</select>
									</dd>
									<dt id="dt-name">真实姓名：</dt>
									<dd>
									    <input type="text" id="realname" name="realname" placeholder="" th:value="${cerInfo.realname }"/>
								        <span class="error"></span>
									    <input type="hidden" id="clientType" name="clientType" th:value="${cerInfo.clientType}" />
									</dd>
									<dt>证件号码：</dt>
									<dd>
									     <input type="text" id="idNbr" name="idNbr" placeholder="身份证号码" th:value="${cerInfo.idNbr }"/>
								         <span class="error"></span>
									</dd>
									<dt>证件照片：</dt>
									<dd>
										<div class="clearfix">
											<!-- <img id="preview" src="${smsp_img_url}/file/scanPic.html?path=${cerInfo.imgUrl}" alt="证件照"  th:src="${cerInfo.imgUrl}" th:if="@{cerInfo.imgUrl != null}"/>
																					    <img id="preview" class="eg-preview" src="img/acount-id.png" alt="证件照" th:src="@{/img/acount-id.png}" th:if="@{cerInfo.imgUrl}"/> -->
											<img id="preview" src="${smsp_img_url}/file/scanPic.html?path=${cerInfo.imgUrl}" alt="证件照"  th:src="${cerInfo.imgUrl}" th:if="not @{cerInfo.imgUrl}"/>
								    		<img id="preview" class="eg-preview" src="img/acount-id.png" alt="证件照" th:src="@{/img/acount-id.png}" th:if="@{cerInfo.imgUrl}"/>
										</div>
										<div class="explain"></div>
										<input type="hidden" id="imgUrl" name="imgUrl" value="" />
									</dd>
									<dt><a href="javascript:;" id="saveCer" class="green-btn" onclick="saveCer(this)">添加资质</a></dt>
								</dl>
								</form>
							    <form method="post" id="imgForm" novalidate="novalidate" enctype="multipart/form-data">
							   		<input type="file" id="photoFile" accept="image/jpeg,image/jpg,image/gif" name="photoFile" />
							   		<a href="javascript:;" id="saveCer" class="green-btn" onclick="uploadCer(this)">上传</a>
							   	</form>
							</div>
						</div>
					</div>
					<div class="btm-copyright">
						<p>© 2016 ucpaas.com 版权所有 粤ICP备14046848号</p>
					</div>
				</div>
			</div>
		</div>
		<!-- 右边内容 ef -->
	</div>   
	<script th:inline="javascript">
	/*<![CDATA[*/
		var mainFlag = '';
		var nameFlag = false;
		var idFlag = false;
		var picFlag = false;
		var picUploadStatus=1;
		var fileUrl ;
		$(function() {
			mainFlag = $("#flag").val();
			if(mainFlag == 'update'){
				$("option[value='${cerInfo.idType}']").attr("selected","selected");
				$("#saveCer").html("修改资质");
				$("#flag").val("update");
			}
			chooseFlag();
			$("#photoFile").change(function() {
				var $file = $(this);
				var fileObj = $file[0];
				var windowURL = window.URL || window.webkitURL;
				var dataURL;
				var $img = $("#preview");
				if(fileObj && fileObj.files && fileObj.files[0]){
					dataURL = windowURL.createObjectURL(fileObj.files[0]);
					fileUrl = fileObj.files[0];
					$img.attr('src',dataURL);
				}else{
					dataURL = $file.val();
					fileObj.files[0] = fileUrl;
// 					$file.val(fileUrl);
					var imgObj = document.getElementById("preview");
// 					imgObj.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
// 					imgObj.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = dataURL;
				}
			});  
			
			$(".tab ul li").click(function() {
				var sib = $(this).siblings('li');
				sib.each(function() {
					var t = $(this).attr("data-flag");
					var showCon = $("." + t);
					showCon.hide();
				});	
				sib.children('a').removeClass('cur');
				var target = $(this).attr("data-flag");
				var tt = $("." + target);
				tt.show();
				$(this).children('a').addClass('cur');
				chooseFlag();
			});
			
			var clientType = $('#clientType').val();
			if(clientType == 1){
				$(".dl-1").css('display','block');
				$(".dl-2").css('display','none');
			}else{
				$(".dl-1").css('display','none');
				$(".dl-2").css('display','block');
			}
			
// 			var message=$("#message").val();
// 			   if(message.length!=0){
// 				   layer.alert(message);
// 			   }
			$("#realname").bind('input propertychange', function(){
				checkname();
			});
			$("#idNbr").bind('input propertychange', function(){
				checkId();
			});
			   
		});
		
		function chooseFlag(){
			var flag = $(".acount-content .cur").text();
			if(flag != '个人'){
				$("#clientType").val(2);
				$("#dt-name").text("公司名称：");
				$(".explain").text("将通过年检的营业执照原件或盖章的复印件扫描、拍照后上传，文件支持2M以内的JPEG、JPG、GIF格式");
				$("#realname").attr("placeholder","公司名与营业执照统一");
				$("#idNbr").attr("placeholder","与证件照保持一致");
				$(".dl-2 select").attr("name","idType");
				$(".dl-1 select").removeAttr("name");
				if(mainFlag != 'update' && $("#photoFile").val() == ''){
					$(".eg-preview").attr({"src":/*[[@{/img/acount-img.png}]]*/"${ctx}/img/acount-img.png","alt":"营业执照"});
				}
			}else{
				$("#clientType").val(1);
				$("#dt-name").text("真实姓名：");
				$(".explain").text("请使用真实有效的身份证按上图示例拍照，需确保证件内容及脸部清晰，上传图片支持2M以内的JPEG、JPG、GIF格式")
				$("#realname").attr("placeholder","请输入真实姓名");
				$("#idNbr").attr("placeholder","与证件照保持一致");
				$(".dl-1 select").attr("name","idType");
				$(".dl-2 select").removeAttr("name");
				if(mainFlag != 'update' && $("#photoFile").val() == ''){
					$(".eg-preview").attr({"src":/*[[@{/img/acount-id.png}]]*/"${ctx}/img/acount-id.png","alt":"证件照"});
				}
			}
			
		}
		
		function checkname(){
			nameFlag = false;
			var str = $("#realname").val();
			var error = $("#realname ~ .error");
			if(str==null||str.trim()==''){
				error.html("该项不能为空");
				return;
			}
			error.html("");
			if(str.length > 60){
				error.html("字数不能超过60");
				return;
			}
			error.html("");
			nameFlag = true;			
			return nameFlag;
		}
		
		function checkId(){
			idFlag = false;
			var str = $("#idNbr").val();
			var error = $("#idNbr ~ .error");
			if(str==null||str.trim()==''){
				error.html("证件号不能为空");
				return;
			}
			error.html("");
			if(str.length > 20){
				error.html("长度超出限制");
				return;
			}
			error.html("");
			idFlag = true;
			return idFlag;			 
		}
		
		 var maxsize = 2*1024*1024;//2M  
         var errMsg = "上传的附件文件不能超过2M！！！";  
        var tipMsg = "您的浏览器暂不支持计算上传文件的大小，确保上传文件不要超过2M，建议使用高版本浏览器。";  
        var  browserCfg = {};  
		
		function checkPic(mainFlag){
			
	        var ua = window.navigator.userAgent;  
	        if (ua.indexOf("MSIE")>=1){  
	            browserCfg.ie = true;  
	        }else if(ua.indexOf("Firefox")>=1){  
	            browserCfg.firefox = true;  
	        }else if(ua.indexOf("Chrome")>=1){  
	            browserCfg.chrome = true;  
	        }  
			picFlag = false;
			var photo = $("#photoFile");
			  
			if (mainFlag != 'update' && photo.val() == '') {
				layer.msg('<p style="color:black">选择需要上传的图片</p>',{
					icon : 2
				});
				return picFlag;
			}else if(mainFlag == 'update' &&photo.val() == ''){
				picFlag = true;
				return picFlag;
			}
			
            var filesize = 0;  
            if(browserCfg.firefox || browserCfg.chrome ){  
                filesize = photo[0].files[0].size;  
            }else if(browserCfg.ie){  
                 var obj_img = $("#preview");  
                 obj_img.dynsrc=photo.value;  
                 filesize = obj_img.fileSize;  
             }else{  
//                  layer.alert(tipMsg, {icon: 2}); 
				 picFlag = true;
                 return picFlag;  
             }  
             if(filesize==-1){  
                 layer.alert(tipMsg, {icon: 2}); 
                 return;  
             }else if(filesize>maxsize){  
                 layer.alert(errMsg, {icon: 2}); 
                 return picFlag;  
             }else{  
				 picFlag = true;
                 return picFlag;  
             }  
        }  
			
			

		function saveCer(btn) {
			var mainFlag = $("#flag").val();
			checkname();
			checkId();
			checkPic(mainFlag);
			if (nameFlag == false || idFlag == false || picFlag == false) {
				return;
			}
			if(picUploadStatus != 1){
				layer.msg('<p style="color:black">图片正在上传,请稍后...</p>', {
					icon : 2
				});
				return;
			}
			var url = /*[[@{/console/qualification/save}]]*/"${ctx}/qualification/save";
			var options = {
				beforeSubmit : function() {
					$(btn).attr("disabled", true);
				},
				url : url,
				async: false,
				success : function(data) {
					if(data == ""){
						return;	//session超时
					}
					$(btn).attr("disabled", false);
					if (data.result == null) {
						layer.alert("服务器错误，请联系管理员", {
							icon : 2
						});
						return;
					} else if (data.result == "success") {
						layer.msg('<p style="color:black">'+data.msg+'</p>', {
							icon : 1
						}, function() {
							window.location.href = /*[[@{/console/qualification}]]*/"${ctx}/qualification";
						});
					} else {
						layer.alert(data.msg, {
							icon : 2
						});
					}
				},
				type : "post",
				timeout : 30000
			};
			layer.confirm("确认提交资质", function(index) {
				$("#mainForm").ajaxSubmit(options);
				layer.close(index);
			});
		}
		
		function uploadCer(btn) {
			checkPic("");
			if (picFlag == false) {
				return;
			}
			var url = $("#smsp_img_url").val()+"/upload/uploadAuto.html";
				  
			var clientType =  $("#clientType").val();
			var options = {
				beforeSubmit : function() {
					picUploadStatus=2;
					$(btn).attr("disabled", true);
				},
				url : url,
				data:{
					userId:$("#clientId").val(),
					idType:$(".dl-"+clientType+"select").val(),
					oauthType : 1
				
				},
				beforeSubmit: function(){
					ityzl_SHOW_LOAD_LAYER("正在上传图片，请勿刷新页面...");
				},
				success : function(data) {
					layer.closeAll(); //疯狂模式，关闭所有层
					picUploadStatus = 1;
					if(data == ""){	//session超时
						$("#imgUrl").val("");
						return;
					}
					$(btn).attr("disabled", false);
					if (data.result == null) {
						$("#imgUrl").val("");
						layer.alert("服务器错误，请联系管理员", {
							icon : 2
						});
						return;
					} else if (data.result == "success") {
						$("#imgUrl").val(data.path);
						layer.msg('<p style="color:black">'+data.msg+'</p>', {
							icon : 1
						});
					} else if(data.reusult == "none"){
						layer.msg('<p style="color:black">'+data.msg+'</p>', {icon : 0},function(){
							$("#imgUrl").val("");
						});
					}else{
						layer.msg('<p style="color:black">'+data.msg+'</p>', {icon:2},function(){
							$("#imgUrl").val("");
						});
					}
				},
				error: function (error) {
					layer.closeAll(); //疯狂模式，关闭所有层
					layer.alert('服务器正忙，请稍后再试', {icon: 2});  
				},
				dataType:"json",
				type : "post",
				timeout : 600000
			};
			
			layer.confirm("确认上传图片?", function(index){
				$("#imgForm").ajaxSubmit(options);
				layer.close(index);
			});
		}

		/*]]>*/
		</script>
	
</body>
</html>